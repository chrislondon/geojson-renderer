<html>
  <head>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css"/>
    <style>
              
#properties-view {
  position: absolute;
  margin: 10px;
  padding: 5px;
  box-sizing: border-box;
  transition: all .4s ease-in-out;
  -moz-transition: all .4s ease-in-out;
  -webkit-transition: all .4s ease-in-out;
  background-color:#E7E2DD;
}

.hidden {
  visibility: hidden;
  opacity: 0;
}

.active {
  opacity: 1;

  visibility: visible
}

.button-blue {
  background-color: #1D71B8;
  border-color: #1D71B8;
}

            </style>
    <title>geojson-renderer</title>
  </head>
  <body>
    <div id="properties-view" class="hidden">
      <div id="feature-header"></div>
      <table>
        <thead>
          <tr>
            <th>Property</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody id="properties-table">
                </tbody>
      </table>
      <button class="button button-blue" id="close-button">Close</button>
    </div>
    <svg version="1.1" height="800" width="1200" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <g class="geojson-tiles">
        <image height="256px" width="256px" y="-203" x="-168" xlink:href="http://b.tile.openstreetmap.org/3/5/2.png"/>
        <image height="256px" width="256px" y="53" x="-168" xlink:href="http://a.tile.openstreetmap.org/3/5/3.png"/>
        <image height="256px" width="256px" y="309" x="-168" xlink:href="http://b.tile.openstreetmap.org/3/5/4.png"/>
        <image height="256px" width="256px" y="565" x="-168" xlink:href="http://c.tile.openstreetmap.org/3/5/5.png"/>
        <image height="256px" width="256px" y="-203" x="88" xlink:href="http://a.tile.openstreetmap.org/3/6/2.png"/>
        <image height="256px" width="256px" y="53" x="88" xlink:href="http://b.tile.openstreetmap.org/3/6/3.png"/>
        <image height="256px" width="256px" y="309" x="88" xlink:href="http://c.tile.openstreetmap.org/3/6/4.png"/>
        <image height="256px" width="256px" y="565" x="88" xlink:href="http://a.tile.openstreetmap.org/3/6/5.png"/>
        <image height="256px" width="256px" y="-203" x="344" xlink:href="http://b.tile.openstreetmap.org/3/7/2.png"/>
        <image height="256px" width="256px" y="53" x="344" xlink:href="http://c.tile.openstreetmap.org/3/7/3.png"/>
        <image height="256px" width="256px" y="309" x="344" xlink:href="http://a.tile.openstreetmap.org/3/7/4.png"/>
        <image height="256px" width="256px" y="565" x="344" xlink:href="http://b.tile.openstreetmap.org/3/7/5.png"/>
        <image height="256px" width="256px" y="-203" x="600" xlink:href="http://c.tile.openstreetmap.org/3/0/2.png"/>
        <image height="256px" width="256px" y="53" x="600" xlink:href="http://a.tile.openstreetmap.org/3/0/3.png"/>
        <image height="256px" width="256px" y="309" x="600" xlink:href="http://b.tile.openstreetmap.org/3/0/4.png"/>
        <image height="256px" width="256px" y="565" x="600" xlink:href="http://c.tile.openstreetmap.org/3/0/5.png"/>
        <image height="256px" width="256px" y="-203" x="856" xlink:href="http://a.tile.openstreetmap.org/3/1/2.png"/>
        <image height="256px" width="256px" y="53" x="856" xlink:href="http://b.tile.openstreetmap.org/3/1/3.png"/>
        <image height="256px" width="256px" y="309" x="856" xlink:href="http://c.tile.openstreetmap.org/3/1/4.png"/>
        <image height="256px" width="256px" y="565" x="856" xlink:href="http://a.tile.openstreetmap.org/3/1/5.png"/>
        <image height="256px" width="256px" y="-203" x="1112" xlink:href="http://b.tile.openstreetmap.org/3/2/2.png"/>
        <image height="256px" width="256px" y="53" x="1112" xlink:href="http://c.tile.openstreetmap.org/3/2/3.png"/>
        <image height="256px" width="256px" y="309" x="1112" xlink:href="http://a.tile.openstreetmap.org/3/2/4.png"/>
        <image height="256px" width="256px" y="565" x="1112" xlink:href="http://b.tile.openstreetmap.org/3/2/5.png"/>
      </g>
      <g class="geojson-features">
        <g data-properties="{&quot;description&quot;:&quot;Line crossing the antimeridian, represented as MultiLineString cut at antimeridian per https://tools.ietf.org/html/rfc7946#section-3.1.9&quot;}" fill-opacity="0.6" fill="#555555" stroke-width="3" stroke="#555555" class="geojson-feature">
          <desc>
      Line crossing the antimeridian, represented as MultiLineString cut at antimeridian per https://tools.ietf.org/html/rfc7946#section-3.1.9
    </desc>
          <polyline fill="None" points="486.22222222222223,60.33011505373372 600.0,60.33011505373372"/>
          <polyline fill="None" points="600.0,60.33011505373372 713.7777777777778,60.33011505373372"/>
        </g>
        <g data-properties="{&quot;stroke&quot;:&quot;none&quot;,&quot;fill&quot;:&quot;blue&quot;,&quot;description&quot;:&quot;Filled rectangle straddling the antimeridian, represented as MultiPolygon cut at antimeridian per https://tools.ietf.org/html/rfc7946#section-3.1.9&quot;}" fill-opacity="0.6" fill="blue" stroke-width="3" stroke="none" class="geojson-feature">
          <desc>
      Filled rectangle straddling the antimeridian, represented as MultiPolygon cut at antimeridian per https://tools.ietf.org/html/rfc7946#section-3.1.9
    </desc>
          <polygon points="600.0,425.16133250784173 486.22222222222223,425.16133250784173 486.22222222222223,738.2615355176783 600.0,738.2615355176783 600.0,425.16133250784173"/>
          <polygon points="600.0,425.16133250784173 600.0,738.2615355176783 713.7777777777778,738.2615355176783 713.7777777777778,425.16133250784173 600.0,425.16133250784173"/>
        </g>
      </g>
      <g id="geojson-selected-feature"/>
    </svg>
    <script>
            (function () {
    const toArray = (htmlCollection) =>
        (htmlCollection);

    const features = Array.prototype.slice.call(
        document.getElementsByClassName("geojson-feature")
    );

    document.getElementById("close-button").addEventListener("click", () => {
            var propertiesView = document.getElementById("properties-view")
            propertiesView.classList.remove("active")
            propertiesView.classList.add("hidden")
        }
    );

    document.addEventListener("click", (event) => {
        console.log("CLICK")

        const currentlySelectedFeature = features.find(feature => feature.classList.contains("selected"))
        currentlySelectedFeature && currentlySelectedFeature.classList.remove("selected")

        const touchedUponFeatures = document.elementsFromPoint(event.x, event.y)
            .map((element) => element.parentElement)
            .filter((element) => element && element.classList.contains("geojson-feature"))
            .filter((element) => element.parentElement !== document.getElementById("geojson-selected-feature"))

        console.log(touchedUponFeatures)

        const selectedIndex = touchedUponFeatures.indexOf(currentlySelectedFeature)

        const newSelectionIndex = (selectedIndex + 1) % touchedUponFeatures.length

        const feature = touchedUponFeatures[newSelectionIndex]

        if (!feature) {
          document.getElementById("geojson-selected-feature").innerHTML = ""
          const propertiesView = document.getElementById("properties-view");
        propertiesView.classList.remove("active")
        propertiesView.classList.add("hidden")
          return;
        }

        feature.classList.add("selected")

        document.getElementById("geojson-selected-feature").innerHTML = ""
        var clone = feature.cloneNode(true);
        clone.style.stroke="#EA5B0C"
        clone.style.fillOpacity="0"
        document.getElementById("geojson-selected-feature").appendChild(clone)


        const properties = JSON.parse(feature.getAttribute("data-properties"));
        console.log(properties);
        const propertiesView = document.getElementById("properties-view");
        const propertiesContent = document.getElementById("properties-table");
        propertiesContent.innerHTML = Object.entries(properties).map((entry) =>
            "<tr><td>" + entry[0] + "</td><td>" + entry[1] + "</td></tr>"
        ).join("\n");
        var featureHeader = document.getElementById("feature-header");

        var title = ""
        if (properties.title) {
            title = "<h1>" + properties.title + "</h1>\n"
        } else if (properties.name) {
            title = "<h1>" + properties.name + "</h1>\n"
        }
        featureHeader.innerHTML = title
        propertiesView.classList.add("active")
        propertiesView.classList.remove("hidden")
    });
})();
          </script>
  </body>
</html>
